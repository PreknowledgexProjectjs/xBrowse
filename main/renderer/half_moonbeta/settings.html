<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>
    Px | Settings
  </title>
  <!-- Halfmoon CSS -->
  <link href="css/halfmoon-variables.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="../css/toastr.css">
  <!--
    Or,
    Use the following (no variables, supports IE11):
    <link href="path/to/halfmoon.min.css" rel="stylesheet" />
  -->
  <link href="css/tabs.css" rel="stylesheet" />
  <style type="text/css">
    #overlay {
      background: transparent;
      color: #666666;
      position: fixed;
      height: 100%;
      width: 100%;
      z-index: 5000;
      top: 0;
      left: 0;
      float: left;
      text-align: center;
      padding-top: 25%;
      opacity: .80;
    }
    .spinner {
        margin: 0 auto;
        height: 64px;
        width: 64px;
        animation: rotate 0.8s infinite linear;
        border: 5px solid firebrick;
        border-right-color: transparent;
        border-radius: 50%;
    }
    @keyframes rotate {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
  </style>
</head>
<body class="with-custom-webkit-scrollbars with-custom-css-scrollbars" data-dm-shortcut-enabled="true" data-sidebar-shortcut-enabled="true" data-set-preferred-mode-onload="true">
<!-- Page wrapper with .with-sidebar class -->
  <div id="overlay" class="classicPannel">
    <div class="spinner"></div>
    <br/>
    Loading...
  </div>
  <div class="page-wrapper with-sidebar">
    <!-- Sidebar (immediate child of the page wrapper) -->
    <div class="sidebar">
      <div class="sidebar-menu">
        <!-- Sidebar brand -->
        <a href="#" class="sidebar-brand">
          <img src="../../../icons/icon.ico" alt="...">
          xBrowse Pages
        </a>
        <!-- Sidebar content with the search box -->
        <div class="sidebar-content">
          
        </div>
        <!-- Sidebar links and titles -->
        <h5 class="sidebar-title">>>Settings<<</h5>
        <div class="sidebar-divider"></div>
        <a href="#" class="sidebar-link" onclick="activeTab('general')">General</a>
        <a href="#" class="sidebar-link" onclick="activeTab('settings')">Settings</a>
        <a href="#" class="sidebar-link" onclick="activeTab('ua')">User agent</a>
        <br />
        <h5 class="sidebar-title">Other Px Pages</h5>
        <div class="sidebar-divider"></div>
        <a href="history.html" class="sidebar-link">History</a>
        <a href="about.html" class="sidebar-link">About</a>
        <a href="credits.html" class="sidebar-link">Credits</a>
      </div>
    </div>

    <!-- Content wrapper -->
    <div class="content-wrapper" style="margin:10px;">
      <div class="tab default-tab" id="tab-general">
        <h3 id="v-pills-home-tab">General</h3>
        <p> <lang id="info_se"></lang> </p>
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm" onclick="changeSearchEngineto('google')">
              <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/2048px-Google_%22G%22_Logo.svg.png" class="card-img-top" alt="google" style="width:100px; height: 100px;">
              <p>Google</p></div>
            <div class="col-sm" onclick="changeSearchEngineto('yahoo')">
              <img src="https://cdn.vox-cdn.com/thumbor/JiRzoaU535Vs9YjU6LcJSvIGFBs=/1400x1400/filters:format(jpeg)/cdn.vox-cdn.com/uploads/chorus_asset/file/19224216/mb_yahoo_02.jpg" class="card-img-top" alt="google" style="width:100px; height: 100px;">
              <p>Yahoo</p>
            </div>
          </div>
        </div>
      </div>
      <div class="tab" id="tab-settings">
        <h1>Settings</h1>
        <div class="mb-3">
            <p><lang id="change_language"></lang></p>
        </div>
        <div class="mb-3">
          <label for="cL" class="form-label"><lang id="change_language"></lang>: Browser Restart required (::::!!!!)</label>
          <select class="form-control" id="cL">
            <option value="en"> English (EN) </option>
            <option value="sp"> Spanish (SP) </option>
          </select>
        </div>

        <button style="margin-top:14px;" onclick="change_language()" class="btn btn-success" id="save_changes3"><lang id="save_changes"></lang></button>
      </div>
      <div class="tab" id="tab-ua">
        <div class="mb-3">
          <p><lang id="if_ya_ua"></lang></p>
        </div>
        <div class="mb-3">
          <label for="useragent" class="form-label"><lang id="custom_useragent"></lang></label>
          <input type="textarea" class="form-control" id="useragent" placeholder="Warrning : might break some websites">
        </div>

        <button onclick="save()" style="margin-top:14px;" class="btn btn-success" id="save_changes2"><lang id="save_changes"></lang></button>
        </div>
      </div>
    </div>
  </div>
<!-- Halfmoon JS -->
<script src="js/halfmoon.min.js"></script>
<script type="text/javascript" src="../js/ajaxjs.js"></script>
<script src="js/tabs.js"></script>
<script type="text/javascript" src="../js/bundle.js"></script>
<script type="text/javascript" src="../js/toastr.js"></script>
<script src="../js/socket.io.js"></script>
<script type="text/javascript">
  //preload inputs
  let url = new URL(window.location.href)
  let params = new URLSearchParams(url.search);
  var lang = JSON.parse(url.searchParams.get("lang"));
  if (localStorage.user_agent == undefined) {
    $('#useragent').val('');
  }else{
    $('#useragent').val(localStorage.user_agent);
  }
  //functions
  function save(){
    localStorage.setItem('user_agent',$('#useragent').val());
    toastr.info("Setting saved. Some settings may need restart to take effect");
  }

  var socket = io.connect('http://localhost:'+params.get('port'),{secure: true,rejectUnauthorized: false});
  socket.on('connect',function(){
    $('#extra').show();
    $('.classicPannel').remove();
    var sendFy = true;
    
    socket.emit('code_exec',`settings_data.get("alert_exp_feature")`,"settings_alert");

    socket.on('code_exec_result', function(code,page) {
      if (sendFy == true) {
        if (page == "settings_alert") {
          console.log(code);
          if (code == "true") {
            sendFy = false;
            socket.emit('toastR', "Warrning : Expirmental Features are Running they might gave problems If you want to disable this dialog please check Settings > Alerts");
          }
          if(code == "false"){
            $('#ex_pa').find(`option[value="false"]`).prop('selected', true);
          }
          if(code == null){
            sendFy = false;
            socket.emit('toastR', "Warrning : Expirmental Features are Running they might gave problems If you want to disable this dialog please check Settings > Alerts");
          }
        }
      }
      if (page == "settingalertChange") {
        toastr.success("Successfully Changed");
      }
    });
  });

  function saveAlertChanges(){
    socket.emit('code_exec',`settings_data.set('alert_exp_feature','${$('#ex_pa option:selected').val()}')`,"settingalertChange");
  }

  function changeSearchEngineto(data){
    toastr.success("Successfully changed default search changed to "+data);
    socket.emit('code_exec',`settings_data.set('default_search','${data}')`,"X");
  }

  function change_language(){
    save_language($('#cL option:selected').val());
  }

  function save_language(data){
    toastr.success("Successfully changed default language to "+data);
    toastr.info("Please restart your browser to apply changes");
    socket.emit('code_exec',`settings_data.set('default_lang','${data}')`,"X");
  }

  $.each(lang, function(index, value) {
    console.log("Index:"+index+"\nValue:"+value)
    $(`#${index}`).html(value);
    $(`#${index}`).attr('value',index);
  });

  window.location.href = "#";
</script>
</body>
</html>